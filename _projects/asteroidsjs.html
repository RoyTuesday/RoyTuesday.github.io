---
permalink: /projects/asteroids-js
---
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Asteroids JS</title>
    <style media="screen">
      #main {
        background: #226;
        color: #FFF;
        font: 1rem monospace;
        text-align: center;
        position: absolute;
        top: 0;
        left: 0;
        margin: 0;
        padding: 2vh 0;
        width: 100%;
        min-height: 100vh;
        box-sizing: border-box;
      }
      #canvas {
        background: #000;
        display: inline-block;
        margin: 0 auto;
        height: 96vh;
        max-height: 600px;
        width: 130vh;
        max-width: 800px;
      }
      aside {
      	display: inline-block;
        width: 28vh;
      	max-width: 200px;
        height: 96vh;
        max-height: 600px;
      	vertical-align: top;
      	margin: 0 auto 0 2vh;
      }
      #score-container {
        margin: 0 0 16px 0;
        height: 12%;
      }
      #input-container {
        display: block;
        width: 100%;
        height: 12%;
      }
      .input-block {
        display: inline-block;
        width: 30%;
        margin: 0 auto;
      }
      label {
        display: block;
        text-shadow: -1px -1px 1px #777, 1px 1px 1px black;
      }
      #score-container label:first-child {
        margin-bottom: 10px;
      }
      #score-container label,
      #score-container .input-wrapper {
        display: inline-block;
        margin: 0 auto;
        vertical-align: top;
      }
      #score-container label {
        line-height: 29px;
        width: 45%;
      }
      #score-container .input-wrapper {
        width: 55%;
      }
      .input-wrapper {
        background: #000;
        width: 100%;
        padding: 4px;
        margin: 6px 0;
        box-sizing: border-box;
        overflow: hidden;
      }
      input {
        background: transparent;
        color: #FFF;
        font: 1rem monospace;
        border: none;
        width: 100%;
        box-sizing: border-box;
        transition: 230ms;
        text-align: center;
        box-sizing: border-box;
        box-shadow: 0 0 16px 0 #FFF7;
      }
      #input-container input:hover,
      #input-container input:focus {
        box-shadow: 0 0 16px 0 #FFF;
      }
      .button {
        width: 20vh;
      	max-width: 120px;
        height: 20vh;
      	max-height: 120px;
      	border-radius: 50%;
      	border: 4px solid;
        margin: 30% auto;
        position: relative;
        box-sizing: border-box;
        box-shadow: 2px 1px 0 2px black;
      }
      .button:after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        border: 3px solid;
        width: 85%;
        height: 85%;
        box-sizing: border-box;
      }
      .button:hover:after {
        border-width: 2px;
      }
      .button:active:after {
        border-width: 5px;
      }
      .button.button-red {
        background: radial-gradient(at 16px 16px, red 20%, #F77 80%);
        border-color: #F44;
      }
      .button.button-red:after {
        background: radial-gradient(at 80px 80px, red 20%, #F44 80%);
        border-color: #500;
      }
      .button.button-red:hover:after {
        background: radial-gradient(at 80px 80px, #F22 20%, #F55 80%);
      }
      .button.button-red:active:after {
        background: radial-gradient(at 60px 60px, #C00 20%, #D22 80%);
      }
      .button.button-yellow {
        background: radial-gradient(at 16px 16px, #DD0 20%, #FF7 80%);
        border-color: #FF4;
      }
      .button.button-yellow:after {
        background: radial-gradient(at 80px 80px, #DD0 20%, #FF4 80%);
        border-color: #550;
      }
      .button.button-yellow:hover:after {
        background: radial-gradient(at 80px 80px, #DD2 20%, #FF5 80%);
      }
      .button.button-yellow:active:after {
        background: radial-gradient(at 60px 60px, #CC0 20%, #DD2 80%);
      }
      .small-screen {
        display: none;
      }
      @media (orientation: portrait) and (max-width: 600px), (orientation:portrait) and (max-height: 480px) {
        #wrapper {
          display: none;
        }
        .small-screen {
          display: block;
          color: #EEE;
          margin: 4em 1em;
        }
      }
    </style>
  </head>
  <body>
    <div id="main">
      <div id="wrapper">
        <canvas id="canvas" width="800" height="600">
          Sorry, your browser does not meet the minimum requirements for this game
        </canvas>
        <aside>
          <div id="score-container">
            <label for="score">Score</label><div class="input-wrapper"><input id="score" disabled="disabled"/></div>
            <label for="hiscore">Hi score</label><div class="input-wrapper"><input id="hiscore" disabled="disabled"/></div>
          </div>
          <div id="input-container">
            <div class="input-block"><label for="red">Red</label><div class="input-wrapper"><input data-color="r" name="red" value="255"/></div></div>
            <div class="input-block"><label for="green">Green</label><div class="input-wrapper"><input data-color="g" name="green" value="255"/></div></div>
            <div class="input-block"><label for="blue">Blue</label><div class="input-wrapper"><input data-color="b" name="blue" value="255"/></div></div>
          </div>
        </aside>
      </div>
      <div class="small-screen">
        Sorry, your screen is too small to play this game
      </div>
    </div>

    <script type="text/javascript">
      var MAX_ASTEROIDS = 7;
      var MAX_SPEED = 4;
      var ASTEROID_SPEED = 1;
      var INPUTS = {
        'ArrowLeft': 'left',
        'ArrowRight': 'right',
        'ArrowUp': 'move',
        ' ': 'fire'
      }

      var scene = 'title';
      var score = 0;
      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');
      context.textAlign = 'center';
      context.fillStyle = '#FFF';
      context.strokeStyle = '#FFF';
      context.lineWidth = 1;

      document.getElementById('hiscore').value = updateScore(true);
      function updateScore(reset) {
        if (reset) score = 0;
        else score++;
        document.getElementById('score').value = score;
        return score;
      }

      document.querySelectorAll('input').forEach(function(input) {
        input.addEventListener('keyup', updateColor);
        updateColor({target: input});
      });
      function updateColor(event) {
        var color, newColor;
        var colors = {
          r: parseInt(context.strokeStyle.substr(1,2), 16),
          g: parseInt(context.strokeStyle.substr(3,2), 16),
          b: parseInt(context.strokeStyle.substr(5,2), 16)
        }
        if (isNaN(event.target.value)) {
          event.target.value = colors[event.target.dataset.color];
        }
        else {
          if (event.target.value < 0 || event.target.value > 255 || event.target.value % 1 !== 0) {
            color = Math.max(0, Math.min(255, Math.round(event.target.value)));
            event.target.value = color;
          }
          else {
            color = event.target.value;
          }
          colors[event.target.dataset.color] = color;
          newColor = 'rgb(' + colors.r + ',' + colors.g + ',' + colors.b + ')';

          context.strokeStyle = newColor;
          context.fillStyle = newColor;
        }
      }

      var Vector = function(rad, mag) {
        this.rad = typeof rad === 'number' ? rad : 0;
        this.mag = typeof mag === 'number' ? mag : 0;
        return this;
      }
      Vector.prototype.add = function(other) {
        var x = (this.mag * Math.cos(this.rad)) + (other.mag * Math.cos(other.rad));
        var y = (this.mag * Math.sin(this.rad)) + (other.mag * Math.sin(other.rad));
        this.rad = Math.atan2(y, x);
        this.mag = Math.min(MAX_SPEED, Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2)));
        return this;
      }

      var explosions = [];
      var Explosion = function(actor, end) {
        this.x = actor.x;
        this.y = actor.y;
        this.frame = 0;
        this.end = end ? end : 8;
        return this;
      }

      var Actor = function(x, y, vel, dir) {
        this.x = x;
        this.y = y;
        this.vel = vel;
        this.dir = dir ? dir : new Vector(vel.rad, 0);
        return this;
      }

      var asteroids = [];
      while (asteroids.length < 3) spawnAsteroid();
      function spawnAsteroid(ast, rad) {
        var x, y, size;
        if (ast && rad) {
          x = ast.x + ((ast.dir.mag + 2) * Math.cos(rad));
          if (x < 0) x += canvas.width;
          else if (x > canvas.width) x -= canvas.width;

          y = ast.y + ((ast.dir.mag + 2) * Math.sin(rad));
          if (y < 0) y += canvas.height;
          else if (y > canvas.height) y -= canvas.height;

          size = ast.dir.mag - 16;
        }
        else {
          size = 16 * (Math.ceil(Math.random() * 3));
          var rad = Math.random() * (Math.PI * 2);
          var perimPoint = Math.random() * ((2 * canvas.width) + (2 * canvas.height));
          if (perimPoint < canvas.width) {
            x = perimPoint;
            y = 0;
          }
          else if (perimPoint < canvas.width + canvas.height) {
            x = canvas.width;
            y = perimPoint - canvas.width;
          }
          else if (perimPoint < (canvas.width * 2) + canvas.height) {
            x = perimPoint - (canvas.width + canvas.height);
            y = canvas.height;
          }
          else {
            x = 0;
            y = perimPoint - ((canvas.width * 2) + canvas.height);
          }
        }
        asteroids.push(new Actor(x, y, new Vector(rad, ASTEROID_SPEED), new Vector(Math.random() * (Math.PI * 2), size)));
      }

      var missile = false;
      var player;
      function setPlayer() {
        player = {
          x: canvas.width / 2,
          y: canvas.height / 2,
          vel: new Vector(),
          dir: new Vector(),
          size: 8,
          rot: 0
        }
      }

      document.addEventListener('keydown', handleInput);
      document.addEventListener('keyup', handleInput);
      function handleInput(event) {
        if (event.target.tagName !== 'INPUT' && ! event.repeat && INPUTS[event.key]) {
          event.preventDefault();
          switch (INPUTS[event.key]) {
            case 'left': player.rot -= event.type == 'keydown' ? 1 : -1; break;
            case 'right': player.rot += event.type == 'keydown' ? 1 : -1; break;
            case 'move': updateThrusters(event); break;
            case 'fire':
              if (event.type == 'keydown') {
                launchMissile();
              }
              break;
          }
        }
      }
      function launchMissile() {
        if (scene !== 'game') reset();
        else if (! missile) {
          missile = new Actor(player.x, player.y, new Vector(player.dir.rad, MAX_SPEED + 1));
          setTimeout(function() {missile = false}, 1000);
        }
      }
      function updateThrusters(event) {
        switch (event.type) {
          case 'keydown':
          case 'mousedown':
            player.dir.mag = 1;
            break;
          case 'keyup':
          case 'mouseup':
            player.dir.mag = 0;
            break;
        }
      }
      function reset() {
        setPlayer();
        updateScore(true);
        missile = false;
        asteroids = [];
        while (asteroids.length < 3) spawnAsteroid();
        scene = 'game';
      }

      var updateInterval = window.setInterval(update, 15);
      function update() {
        if (missile) moveActor(missile);
        asteroids.forEach(moveActor);
        handleCollisions();

        switch (scene) {
          case 'game':
            player.dir.rad += (player.rot * (Math.PI / 24));
            if (player.dir.mag > 0) {
              player.vel.add(player.dir);
            }
            moveActor(player);
            break;
        }
      }
      function moveActor(actor) {
        actor.x += actor.vel.mag * Math.cos(actor.vel.rad);
        actor.y += actor.vel.mag * Math.sin(actor.vel.rad);

        if (actor.x < 0) actor.x = canvas.width;
        else if (actor.x > canvas.width) actor.x = 0;

        if (actor.y < 0) actor.y = canvas.height;
        else if (actor.y > canvas.height) actor.y = 0;
      }
      function handleCollisions() {
        for (var i = 0; i < asteroids.length; i++) {
          if (scene == 'game' && detectActorCollision(player, asteroids[i])) {
            gameOver();
            return;
          }
          else if (missile && detectActorCollision(missile, asteroids[i])) {
            missile = false;
            if (asteroids[i].dir.mag === 16) updateScore();
            breakAsteroid(i);
            asteroids.splice(i, 1);
            return;
          }
          else {
            for (var j = 0; j < asteroids.length; j++) {
              if (i !== j && detectActorCollision(asteroids[i], asteroids[j])) {
                breakAsteroid(i);
                breakAsteroid(j);
                var newAsts = [];
                asteroids.forEach(function(ast, index) {
                  if (index !== i && index !== j) newAsts.push(ast);
                });
                asteroids = newAsts;
                return;
              }
            }
          }
        }
      }
      function detectActorCollision(actA, actB) {
        return Math.sqrt(Math.pow(Math.abs((actA.x + actA.dir.mag) - actB.x), 2) + Math.pow(Math.abs((actA.y + actA.dir.mag) - actB.y), 2)) <= actB.dir.mag + actA.dir.mag;
      }
      function breakAsteroid(index) {
        switch (asteroids[index].dir.mag) {
          case 48:
            spawnAsteroid(asteroids[index], asteroids[index].vel.rad + (Math.PI / 2));
            spawnAsteroid(asteroids[index], asteroids[index].vel.rad - (Math.PI / 2));
            break;
          case 32:
            spawnAsteroid(asteroids[index], asteroids[index].vel.rad + (Math.PI / 2));
            spawnAsteroid(asteroids[index], asteroids[index].vel.rad - (Math.PI / 2));
            break;
          default:
            explosions.push(new Explosion(asteroids[index]));
            break;
        }
        if (asteroids.length < MAX_ASTEROIDS) setTimeout(spawnAsteroid, 1000);
      }

      function render() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        // Render missile
        if (missile) context.strokeRect(missile.x - 0.5, missile.y - 0.5, 1, 1);
        // Render asteroids
        asteroids.forEach(function(ast) {
          context.beginPath();
          context.moveTo(ast.x + (ast.dir.mag * (Math.cos(ast.dir.rad))), ast.y + (ast.dir.mag * (Math.sin(ast.dir.rad))));
          context.lineTo(ast.x + (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI / 4)))), ast.y + (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI / 4)))));
          context.lineTo(ast.x + ((ast.dir.mag * 0.8) * (Math.cos(ast.dir.rad - (Math.PI / 3)))), ast.y + ((ast.dir.mag * 0.8) * (Math.sin(ast.dir.rad - (Math.PI / 3)))));
          context.lineTo(ast.x + (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI / 2)))), ast.y + (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI / 2)))));
          context.lineTo(ast.x + (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI * 3 / 4)))), ast.y + (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI * 3 / 4)))));
          context.lineTo(ast.x - (ast.dir.mag * (Math.cos(ast.dir.rad))), ast.y - (ast.dir.mag * (Math.sin(ast.dir.rad))));
          context.lineTo(ast.x - (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI / 4)))), ast.y - (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI / 4)))));
          context.lineTo(ast.x - (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI / 2)))), ast.y - (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI / 2)))));
          context.lineTo(ast.x - ((ast.dir.mag * 1.1) * (Math.cos(ast.dir.rad - (Math.PI * 5 / 8)))), ast.y - ((ast.dir.mag * 1.1) * (Math.sin(ast.dir.rad - (Math.PI * 5 / 8)))));
          context.lineTo(ast.x - (ast.dir.mag * (Math.cos(ast.dir.rad - (Math.PI * 3 / 4)))), ast.y - (ast.dir.mag * (Math.sin(ast.dir.rad - (Math.PI * 3 / 4)))));
          context.closePath();
          context.stroke();

          // Debug render circle hitbox
          // context.strokeStyle = 'red';
          // context.beginPath();
          // context.moveTo(ast.x + ast.dir.mag, ast.y);
          // context.arc(ast.x, ast.y, ast.dir.mag, 0, Math.PI * 2);
          // context.closePath();
          // context.stroke();
          // context.strokeStyle = 'white';
        });

        switch(scene) {
          case 'title':
            context.font = '48px monospace';
            context.fillText('ASTEROIDS', canvas.width / 2, (canvas.height / 2) - 32);
            context.font = '18px monospace';
            context.fillText('Press "fire" to start', canvas.width / 2, (canvas.height / 2) + 8);
            break;
          case 'game':
            // Render player
            context.beginPath();
            context.moveTo(player.x + (16 * Math.cos(player.dir.rad)) + 0.5, player.y + (16 * Math.sin(player.dir.rad)) + 0.5);
            context.lineTo(player.x - (16 * Math.cos(player.dir.rad - (Math.PI / 5))) + 0.5, player.y - (16 * Math.sin(player.dir.rad - (Math.PI / 5))) + 0.5);
            context.lineTo(player.x - (8 * Math.cos(player.dir.rad)) + 0.5, player.y - (8 * Math.sin(player.dir.rad)) + 0.5);
            context.lineTo(player.x - (16 * Math.cos(player.dir.rad + (Math.PI / 5))) + 0.5, player.y - (16 * Math.sin(player.dir.rad + (Math.PI / 5))) + 0.5);
            context.closePath();
            context.stroke();
            // Render exhaust
            if (player.dir.mag !== 0) {
              context.beginPath();
              context.moveTo(player.x - (14 * Math.cos(player.dir.rad)) + 0.5, player.y - (14 * Math.sin(player.dir.rad)) + 0.5);
              context.lineTo(player.x - (18 * Math.cos(player.dir.rad - (Math.PI / 8))) + 0.5, player.y - (18 * Math.sin(player.dir.rad - (Math.PI / 8))) + 0.5);
              context.lineTo(player.x - (32 * Math.cos(player.dir.rad)) + 0.5, player.y - (32 * Math.sin(player.dir.rad)) + 0.5);
              context.lineTo(player.x - (18 * Math.cos(player.dir.rad + (Math.PI / 8))) + 0.5, player.y - (18 * Math.sin(player.dir.rad + (Math.PI / 8))) + 0.5);
              context.closePath();
              context.stroke();
            }
            break;
          case 'over':
            context.font = '64px monospace';
            context.fillText('GAME', canvas.width / 2, (canvas.height / 2) - 32);
            context.fillText('OVER', canvas.width / 2, (canvas.height / 2) + 32);
            break;
        }

        var newExp = [];
        explosions.forEach(function(exp) {
          context.beginPath();
          context.moveTo(exp.x + (exp.frame + 4), exp.y);
          context.arc(exp.x, exp.y, exp.frame + 4, 0, Math.PI * 2);
          context.closePath();
          context.stroke();
          // Increment the explosion's animation frame
          exp.frame++
          if (exp.frame < exp.end) newExp.push(exp);
        });
        explosions = newExp;
      }

      function gameOver() {
        scene = 'over';
        explosions.push(new Explosion(player, 12));
        var hiscore = document.getElementById('hiscore');
        hiscore.value = Math.max(score, hiscore.value);
      }

      // var frameCount = 0;
      window.requestAnimationFrame(step);
      function step(timestamp) {
        render();
        // frameCount = (frameCount + 1) % 60;
        window.requestAnimationFrame(step);
      }
    </script>
  </body>
</html>
