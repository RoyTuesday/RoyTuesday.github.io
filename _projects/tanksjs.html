---
permalink: /projects/tanks-js
---
<!DOCTYPE html><html><head><title>Tanks JS</title><meta charset="utf-8" name="viewport" content="width=device-width initial-scale=1"/><meta property="og:title" content="Tanks JS"/><meta name="description" content="A two-player game using the same keyboard; blow up your opponent's tank more times to win, but watch out for ricochet! Based on the game Battle Tanks from Triple Action by Mattel Electronics."/><meta property="og:description" content="A two-player game using the same keyboard; blow up your opponent's tank more times to win, but watch out for ricochet! Based on the game Battle Tanks from Triple Action by Mattel Electronics."/><meta property="og:image" content="{{ "/imgs/tanks-js.jpg" | prepend: site.url }}"/><meta property="og:image:alt" content="Gameplay screenshot of a red and yellow tank squaring off"/><meta property="og:url" content="{{ "/projects/tanks-js" | prepend: site.url }}"/><meta property="og:type" content="website"/><link rel="icon" type="image/png" href="{{ "/imgs/tanks-icon.png" | prepend: site.baseurl }}"/><style type="text/css">@font-face{font-family:'Intellect';src:url('/fonts/intellect.ttf');}body{background:#742;text-align:center;padding:0;margin:0;}.hide{position:absolute!important;padding:0!important;margin:-1px!important;width:1px!important;height:1px!important;left:0!important;top:0!important;right:0!important;bottom:0!important;clip:rect(0 0 0 0);overflow:hidden;}.debug{position:absolute;border:1px solid red;right:0;top:0;}#canvas-wrapper{margin:0 auto;height:100vh;}#canvas{background:#000;width:800px;height:640px;}#canvas table{background:#000;color:#FFF;font:bold 1em/1.2em Helvetica;letter-spacing:1px;border-collapse:collapse;margin:16px auto;}#canvas caption,#canvas th,#canvas td{background:#000;border:1px solid #FFF;padding:1em;}#canvas td{padding:0.5em 1em;}.controls{color:#FFF;font-family:Courier,monospace;text-align:left;text-shadow:1px -1px 1px black,-1px 1px 1px #AAA;padding:0 24px;width:360px;}input[type="checkbox"]{display:none;}input[type="checkbox"]+label{cursor:pointer;display:block;font-size:24px;padding-left:26px;position:relative;margin:0 0 64px;}input[type="checkbox"]+label:before{background:#333;border:2px solid #FFF;border-radius:100%;box-sizing:border-box;content:'';height:18px;left:0;position:absolute;top:5px;width:18px;}input[type="checkbox"]+label:after{background:radial-gradient(circle at center,#F51 25%,#333 100%);border-radius:100%;content:'';height:10px;left:4px;position:absolute;top:9px;transition:transform 200ms;transform:scale(0);width:10px;}input[type="checkbox"]:checked+label:after{transform:scale(1);}.row{font-size:20px;margin:8px auto;text-align:right;width:272px;}.column-2{display:inline-block;padding:0 8px;}.column-2:last-child{text-align:left;width:128px;}</style></head><body><noscript>Please enable JavaScript to play this game</noscript><table id="canvas-wrapper"><tbody><tr><td><canvas id="canvas"width="800"height="640"><table><caption>Sorry, your browser does not meet the minimum requirements for this game</caption><thead><tr><th>Browser</th><th>Oldest Supported Version</th></tr></thead><tbody><tr><td>Internet Explorer</td><td>9.0</td></tr><tr><td>Firefox</td><td>3.6</td></tr><tr><td>Chrome</td><td>4.0</td></tr><tr><td>Safari</td><td>4.0</td></tr><tr><td>Opera</td><td>10.1</td></tr></tbody></table></canvas></td><td class="controls"><input type="checkbox" name="mute" id="mute" checked><label for="mute">Mute Sounds</label><h1>Player 1: <span id="player-1-color"></span></h1><div class="row"><div class="column-2">Forward:</div><div class="column-2">&uarr; (up)</div></div><div class="row"><div class="column-2">Left:</div><div class="column-2">&larr; (left)</div></div><div class="row"><div class="column-2">Right:</div><div class="column-2">&rarr; (right)</div></div><div class="row"><div class="column-2">Backward:</div><div class="column-2">&darr; (down)</div></div><div class="row"><div class="column-2">Fire:</div><div class="column-2">. (period)</div></div><h1>Player 2: <span id="player-2-color"></span></h1><div class="row"><div class="column-2">Forward:</div><div class="column-2">W</div></div><div class="row"><div class="column-2">Left:</div><div class="column-2">A</div></div><div class="row"><div class="column-2">Right:</div><div class="column-2">D</div></div><div class="row"><div class="column-2">Backward:</div><div class="column-2">S</div></div><div class="row"><div class="column-2">Fire:</div><div class="column-2">Tab</div></div></td></tr></tbody></table><canvas id="prerender" class="hide"width="800"height="640"></canvas><canvas id="pretext" class="hide"width="942"height="640"></canvas><canvas id="question"class="hide"width="94"height="80"></canvas></body><script type="text/javascript">const LEVELS=[[0,0,0,1,1,1,1,1,3,0,0,0,2,2,0,1,1,1,1,1,0,0,0,1,1,1,1,1,3,0,0,0,2,2,0,1,3,3,3,3,0,0,0,1,1,1,1,1,3,0,0,0,2,2,0,1,0,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,2,2,0,1,3,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,2,2,0,1,3,0,1,1,0,0,0,0,0,0,0,1,1,0,0,0,2,2,0,1,3,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,1,3,1,1,1,1,1,0,0,0,0,0,0,0,0,0,2,2,2,0,1,3,1,1,1,1,1,1,1,1,1,0,0,0,0,2,2,2,0,0,1,1,1,1,1,3,3,3,3,3,3,0,0,0,2,2,2,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,2,2,0,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,2,2,0,1,1,3,3,3,1,1,1,0,0,0,0,0,0,0,0,0,2,2,0,1,1,0,1,1,1,1,1,0,0,0,0,0,3,0,0,2,2,0,0,1,1,0,1,1,1,1,1,0,0,0,0,1,3,0,0,2,2,0,1,1,1,3,0,1,1,1,1,0,0,0,1,1,3,0,0,2,2,0,1,1,1,3,0,1,1,1,1,0,0,0,1,1,3,3,2,2,3,3,3,1,1,3,1,1,1,0,1,0,0,1,1,0,0,0,2,2,0,0,0,1,1,3,1,1,1,0,1,0,0,1,1,0,0,0,2,2,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,0,0,0,2,2,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,0,0,0,1,1,2,2,2,2,2,2,2,2,2,0,0,1,1,1,1,1,0,0,1,1,2,2,2,2,2,2,2,2,2,0,1,1,1,1,1,0,0,0,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,0,0,0,0,0,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,1,0,0,0,0,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,0,0,0,0,0,0,1,1,2,2,2,2,2,2,2,0,0,1,1,0,0,0,0,0,0,0,1,1,1,2,2,2,2,2,2,0,0,0,0,0,0,0,0,3,0,0,0,1,1,1,1,2,2,2,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,1,1,1,1,1,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,1,1,1,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,3,0,0,0,0,0,0,0,2,2,1,1,1,1,1,1,0,0,0,0,3,0,0,0,0,0,0,0,2,2,2,2,2,1,1,1,1,0,0,0,3,0,0,0,1,1,1,0,2,2,2,2,2,2,1,1,1,0,0,0,3,0,0,1,0,1,1,1,2,2,2,2,2,2,2,1,1,1,0,0,3,0,0,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,0,0,0,0,1,1,1,1,1,0,2,2,2,2,2,2,2,2,1,1,0,0,0,0,1,1,1,1,1,0,2,2,2,2,2,2,2,2,1,1,1,0,0,0,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,3,3,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,1,3,3,0,0,0,1,1,1,0,0,2,2,0,0,3,1,1,1,1,1,1,3,0,0,1,1,1,0,0,2,2,2,2,2,3,3,3,3,1,1,1,3,1,0,1,1,0,0,0,2,2,2,2,2,2,2,2,3,1,1,1,3,1,1,1,0,0,0,2,2,2,2,2,2,2,2,2,2,2,1,1,3,1,1,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,0,1,1,1,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,0,1,1,1,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,1,1,1,0,0,3,3,0,0,3,3,3,3,2,2,2,0,0,0,0,1,1,1,0,0,0,3,0,0,1,1,1,3,0,0,0,0,0,0,0,1,1,1,0,0,0,3,0,0,0,0,1,3,0,0,0,0,0,0,0,1,1,1,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,3,1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,3,1,1,1,3,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,3,1,1,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,0,0,3,0,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,0,3,3,3,3,3,3,3,3,3,3,0,1,1,1,1,1,1,1,1,1,3,0,0,0,0,0,0,0,0,3,3,3,3,1,1,3,3,1,1,1,3,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,1,0,3,0,0,3,0,0,3,0,0,0,1,1,1,1,1,1,1,1,1,1,3,0,0,3,0,0,3,0,0,3,1,1,1,1,1,1,1,1,1,1,3,0,0,3,0,0,3,0,0,3,0,1,1,1,1,1,1,1,1,1,0,0,0,3,0,0,3,0,0,3,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,3,1,1,1,3,3,1,1,3,3,3,3,0,0,0,0,0,0,0,0,3,0,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,3,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,3,1,1,1,3,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,3,1,1,2,2,2,1,1,1,0,0,0,0,1,1,1,1,1,1,1,3,1,2,2,2,2,2,1,1,0,0,0,0],[2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,0,0,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,3,2,0,0,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,3,3,1,1,3,3,3,3,3,3,3,3,1,1,3,1,1,3,1,1,3,3,1,1,3,1,1,3,1,1,1,1,1,1,3,1,1,3,1,1,3,3,1,1,3,1,1,3,1,1,1,1,1,1,1,1,1,3,1,1,3,3,1,1,3,1,1,3,1,1,1,1,1,1,1,1,1,3,1,1,3,3,1,1,3,1,1,3,1,1,3,3,3,3,3,1,1,3,1,1,3,3,1,1,1,1,1,3,1,1,1,1,1,1,3,1,1,3,1,1,3,3,1,1,1,1,1,3,1,1,1,1,1,1,3,1,1,3,1,1,3,3,1,1,3,3,3,3,3,1,1,3,3,3,3,3,3,3,3,3,3,3,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,1,1,3,1,1,3,3,3,3,3,3,1,1,3,3,3,1,1,3,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,1,1,3,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,1,1,3,3,3,3,3,1,1,3,3,3,1,1,3,3,3,3,3,3,1,1,3,3,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,0,0,2,3,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,0,0,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2],[1,1,1,3,0,3,1,1,1,0,0,0,4,4,5,5,5,5,5,5,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,4,4,5,5,5,5,5,5,0,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,4,4,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,4,4,4,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,4,4,4,5,5,5,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,4,4,4,4,5,0,0,0,0,0,1,1,0,0,1,1,1,1,3,1,1,0,0,0,0,0,0,4,4,4,3,0,0,0,0,1,1,1,1,1,1,1,1,3,3,1,1,0,0,0,0,0,0,0,4,3,0,0,0,0,1,1,1,1,1,1,1,1,3,1,1,1,1,1,0,0,0,0,0,0,3,0,0,0,0,1,1,1,1,1,1,1,1,3,1,1,1,3,1,1,1,0,0,0,0,3,0,0,0,0,1,1,1,1,3,3,3,3,3,1,1,1,3,1,1,1,1,1,1,0,3,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,3,3,3,1,1,1,1,3,3,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,3,1,1,1,1,1,1,1,0,0,0,0,0,2,0,0,0,3,3,0,0,1,1,1,1,3,1,1,1,1,1,1,3,3,0,0,0,0,2,2,2,0,0,3,0,0,0,1,1,1,3,1,1,1,1,1,1,0,3,0,0,0,0,2,2,2,2,2,0,0,3,0,1,1,1,3,1,1,1,1,1,0,0,3,0,0,0,0,2,2,2,2,2,2,0,3,3,0,1,3,3,1,1,1,0,0,0,0,3,0,0,0,0,2,2,2,2,2,2,0,0,0,0,1,1,1,1,1,0,0,0,0,1,3,0,0,0,0,2,2,2,2,2,2,2,0,0,0,1,1,1,1,1,0,0,0,0,1,3,0,0,0,0,2,2,2,2,2,2,2,0,0,0,0,1,1,1,0,0,0,0,1,1,3,0,0,0,0],[4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,0,0,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,4,0,0,0,0,0,0,4,4,4,4,4,5,5,5,4,4,4,5,5,4,4,0,0,0,0,0,0,0,0,0,4,4,4,4,4,2,2,4,5,5,4,0,0,0,0,0,4,4,4,0,0,0,0,1,1,2,4,4,5,5,4,0,0,4,4,0,0,0,0,0,4,4,0,0,1,4,4,5,5,5,4,0,0,4,4,0,0,4,4,4,4,1,0,0,0,4,5,5,5,5,4,0,0,4,0,0,4,4,1,1,1,1,4,4,0,4,4,5,5,5,4,0,0,0,0,4,4,1,1,1,1,1,4,0,0,0,4,5,5,5,4,4,0,0,0,4,1,1,1,1,1,4,4,0,0,0,4,4,5,5,5,4,0,0,4,4,1,1,1,1,1,4,0,0,0,0,0,4,5,5,5,4,0,0,4,1,1,1,1,1,4,4,0,0,0,0,0,4,5,5,5,4,4,0,4,1,1,1,1,4,4,0,0,4,0,0,4,4,5,5,5,5,4,0,0,1,4,4,4,4,0,0,4,4,0,0,4,5,5,5,5,4,4,0,0,0,4,0,0,0,0,0,4,4,0,0,4,5,5,5,4,4,1,0,0,0,0,0,0,0,0,4,4,4,0,0,4,4,5,5,4,1,1,1,4,4,4,4,0,0,0,0,0,0,0,0,0,4,4,5,4,1,1,4,4,5,5,4,4,4,4,4,0,0,0,0,0,0,4,5,4,4,4,4,5,5,5,5,5,5,5,4,4,4,4,4,0,0,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4]];const RANDOM=LEVELS.length;var level=LEVELS[0];var levelOption=0;var levelNum=0;var bubbles=[];function getTileIndex(e,t,l){return(e/32>>0)+(l==5?25:20)*(t/32>>0)}function generateBubbles(e,t){let l=[];let r=t==5;for(let t=0;t<400;t++){if(e[t]==5){l.push({x:32*(t%(r?25:20)),y:32*(t/(r?25:20)>>0),step:Math.random()*120>>0})}}return l}var scene="title";var round=1;var roundLimit=5;var cpuOption=0;var cpuSkill=0;var menu={delay:0,showLeft:1,showRight:1};var optionRow=0;const PALETTE=["#951","#791","#158","#722","#333","#C42"];const paletteNames=["Blue/Green","Red/Yellow","Green/Blue","Yellow/Red"];var paletteOption=0;const playerColors=[["#0AF","#0D2"],["#E04","#DE2"],["#0D2","#0AF"],["#DE2","#E04"]];var score=[0,0];var gKeys=[{},{}];var players=[{x:64,y:64,r:0,life:60,delay:0,shells:0},{x:576,y:576,r:3.14,life:60,delay:0,shells:0}];var trails=[[],[]];var cpuTargets=[{x:-1,y:-1},{x:-1,y:-1}];function prerenderTitle(){var e=document.getElementById("prerender").getContext("2d");e.clearRect(0,0,800,640);e.fillStyle="#49C";e.fillRect(0,0,800,640);e.fillStyle="#FFF";e.fillRect(56,48,16,48);e.fillStyle="#FF0";e.fillRect(140,48,16,48);e.fillStyle="#0F0";e.fillRect(224,48,16,48);e.fillStyle="#0A0";e.fillRect(308,48,16,48);e.fillStyle="#FFF";e.fillRect(392,48,16,48);e.fillStyle="#CCA";e.fillRect(476,48,16,48);e.fillStyle="#F00";e.fillRect(560,48,16,48);e.fillStyle="#00F";e.fillRect(644,48,16,48);e.fillStyle="#000";e.fillRect(728,48,16,48);var t=document.getElementById("pretext");var l=t.getContext("2d");l.fillStyle="#FFF";l.font="48px Intellect";l.textAlign="center";l.fillText("Peter  Wood",471,214);l.fillText("presents",471,258);l.fillText("TANKS  JS",471,416);l.fillText("Cpr  @  2017  PNW",471,592);e.drawImage(t,0,0,942,640,0,0,800,640)}function renderTank(e,t,l){e.fillStyle=l;e.beginPath();e.moveTo(t.x+18*Math.cos(t.r+.17),t.y+18*Math.sin(t.r+.17));e.lineTo(t.x+9*Math.cos(t.r+.34),t.y+9*Math.sin(t.r+.34));e.lineTo(t.x+12*Math.cos(t.r+1),t.y+12*Math.sin(t.r+1));e.lineTo(t.x-14*Math.cos(t.r-.79),t.y-14*Math.sin(t.r-.79));e.lineTo(t.x-14*Math.cos(t.r+.79),t.y-14*Math.sin(t.r+.79));e.lineTo(t.x+12*Math.cos(t.r-1),t.y+12*Math.sin(t.r-1));e.lineTo(t.x+9*Math.cos(t.r-.34),t.y+9*Math.sin(t.r-.34));e.lineTo(t.x+18*Math.cos(t.r-.17),t.y+18*Math.sin(t.r-.17));e.closePath();e.fill()}function renderLevelPreview(e){var t=document.getElementById("prerender").getContext("2d");if(e){let l=e.length>400;let r=0;for(let n=0;n<400;n++){if(l&&n>0&&n%20==0){r+=5}t.fillStyle=PALETTE[e[n+r]];t.fillRect(520+4*(n%20),450+4*(n/20>>0),4,4)}}else{t.drawImage(document.getElementById("question"),0,0,94,80,520,450,80,80)}}function prerenderMenu(e,t,l,r,n){var a=document.getElementById("prerender").getContext("2d");a.strokeStyle="#FFF";a.lineWidth=2;var i=document.getElementById("pretext");var o=i.getContext("2d");let s;switch(l){case 0:s="none";break;case 1:s="Player 1";break;case 2:s="Player 2";break;case 3:s="Both";break}let u=n==RANDOM?"random":n+1;let c=LEVELS[n];a.clearRect(0,0,800,640);o.clearRect(0,0,942,760);o.font="32px Intellect";o.textAlign="center";o.fillText("Press spacebar to start",471,584);o.font="40px Intellect";o.textAlign="right";o.fillText("Rounds:",377,60);o.fillText("Colors:",377,150);o.fillText("CPU:",377,240);o.fillText("CPU Skill:",377,330);o.fillText("Level:",377,420);o.textAlign="center";o.fillText(e,664,60);o.fillText(paletteNames[t],664,150);o.fillText(s,664,240);o.fillText(r+1,664,330);o.fillText(u,664,420);a.drawImage(i,0,0,942,640,0,0,800,640);renderTank(a,{x:300,y:470,r:0},playerColors[t][0]);renderTank(a,{x:340,y:510,r:3.14},playerColors[t][1]);renderLevelPreview(c)}function prerenderScore(e,t,l){var r=document.getElementById("prerender").getContext("2d");r.clearRect(640,0,160,640);var n=document.getElementById("pretext");var a=n.getContext("2d");a.clearRect(0,0,942,640);a.font="24px Intellect";a.textAlign="left";a.fillText("Round",768,32);a.fillText("of",800,64);a.fillText("Level",768,128);a.fillText(levelOption==RANDOM?"random":levelOption,800,160);a.fillText("Player 1",768,248);a.fillText(e[0],800,280);a.fillText("Player 2",768,352);a.fillText(e[1],800,384);a.textAlign="right";a.fillText(t,910,32);a.fillText(l,910,64);r.drawImage(n,0,0,942,640,0,0,800,640)}function prerenderLevel(e,t,l,r,n){var a=document.getElementById("prerender").getContext("2d");a.clearRect(0,0,800,640);let i=t==5;let o=0;for(let t=0;t<400;t++){if(i&&t>0&&t%20==0){o+=5}a.fillStyle=PALETTE[e[t+o]];a.fillRect(32*(t%20),32*(t/20>>0),32,32)}prerenderScore(l,r,n)}function prerenderFinal(e,t){var l=document.getElementById("prerender").getContext("2d");l.clearRect(0,0,800,640);var r=document.getElementById("pretext");var n=r.getContext("2d");n.clearRect(0,0,942,640);n.font="72px Intellect";n.textAlign="center";n.fillText("Final Score",471,96);n.font="32px Intellect";n.fillText("Press spacebar for new game",471,584);n.font="48px Intellect";n.textAlign="right";n.fillText(e,432,176);n.fillText("Player 1:",546,352);n.fillText("Player 2:",546,448);n.textAlign="left";n.fillText(e>1?"Rounds":"Round",451,176);n.fillText(t[0],584,352);n.fillText(t[1],584,448);l.drawImage(r,0,0,942,640,0,0,800,640)}var shells=[];function Shell(e,t){this.x=e.x+18*Math.cos(e.r);this.y=e.y+18*Math.sin(e.r);this.r=e.r;this.n=t;return this}Shell.prototype.life=128;function moveShell(e,t,l){let r=0;for(let n=0;n<8;n++){let n=Math.cos(t.r);let a=Math.sin(t.r);t.x+=n;t.y+=a;if(t.x<=2||e[t.n].x<640&&t.x>=638||t.x>=798){t.r=Math.atan2(a,-n);if(!r)r=1}if(t.y<=2||t.y>=638){t.r=Math.atan2(-a,n);if(!r)r=1}let i=getTileIndex(t.x,t.y,l);if(level[i]&&level[i]>2&&level[i]<5){let e=16-Math.abs(t.x%32-16)>>0;let l=16-Math.abs(t.y%32-16)>>0;if(e==l){t.r=Math.atan2(-a,-n);if(!r)r=1}else if(e<l){t.r=Math.atan2(a,-n);if(!r)r=1}else{t.r=Math.atan2(-a,n);if(!r)r=1}}}t.life--;return r}function shellCollidesWithPlayer(e,t){return t.life==60&&Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<16}var audio;if(typeof AudioContext!=="undefined"){audio=new AudioContext}else if(typeof webkitAudioContext!=="undefined"){audio=new webkitAudioContext}else{console.error("AudioContext not available")}var mute=window.localStorage.getItem("mute")=="1";if(mute!=null){document.getElementById("mute").checked=mute;if(audio){audio.mute=mute}}else{toggleMute()}function toggleMute(){if(audio){audio.mute=document.getElementById("mute").checked;window.localStorage.setItem("mute",audio.mute?1:0);if(!audio.mute){playTone(0,.2)}else{if(players[0].treads){players[0].treads=stopSound(players[0].treads.o,players[0].treads.g)}if(players[1].treads){players[1].treads=stopSound(players[1].treads.o,players[1].treads.g)}if(players[0].turn){players[0].turn=stopSound(players[0].turn.o,players[0].turn.g)}if(players[1].turn){players[1].turn=stopSound(players[1].turn.o,players[1].turn.g)}}}}document.getElementById("mute").addEventListener("change",toggleMute);function getKey(e){if(typeof e.key=="string"){return e.key}else{switch(e.keyCode){case 9:return"Tab";break;case 32:return" ";break;case 37:return"ArrowLeft";break;case 38:return"ArrowUp";break;case 39:return"ArrowRight";break;case 40:return"ArrowDown";break;case 97:return"a";break;case 100:return"d";break;case 115:return"s";break;case 119:return"w";break;case 190:return".";break;case 192:return"`";break}}}function hkd(e){if(!e.altKey&&!e.ctrlKey&&!e.metaKey){e.preventDefault()}if(!e.repeat){let t=getKey(e);switch(scene){case"title":scene="menu";context.fillStyle="#FFF";prerenderMenu(roundLimit,paletteOption,cpuOption,cpuSkill,levelOption);break;case"menu":case"final":switch(t){case"ArrowLeft":if(typeof menu.col=="undefined"){menu.col=-1}else{menu.col--}break;case"ArrowRight":if(typeof menu.col=="undefined"){menu.col=1}else{menu.col++}break;case"ArrowUp":if(typeof menu.row=="undefined"){menu.row=-1}else{menu.row--}break;case"ArrowDown":if(typeof menu.row=="undefined"){menu.row=1}else{menu.row++}break;case" ":menu.start=1;break}break;case"game":if(cpuOption<3){switch(t){case"ArrowLeft":if(cpuOption!=1){if(typeof gKeys[0].turn=="undefined"){gKeys[0].turn=-1}else{gKeys[0].turn--}}break;case"ArrowRight":if(cpuOption!=1){if(typeof gKeys[0].turn=="undefined"){gKeys[0].turn=1}else{gKeys[0].turn++}}break;case"ArrowUp":if(cpuOption!=1){if(typeof gKeys[0].move=="undefined"){gKeys[0].move=1}else{gKeys[0].move++}}break;case"ArrowDown":if(cpuOption!=1){if(typeof gKeys[0].move=="undefined"){gKeys[0].move=-.5}else{gKeys[0].move-=.5}}break;case".":if(cpuOption!=1){gKeys[0].fire=1};break;case"a":if(cpuOption<2){if(typeof gKeys[1].turn=="undefined"){gKeys[1].turn=-1}else{gKeys[1].turn--}}break;case"d":if(cpuOption<2){if(typeof gKeys[1].turn=="undefined"){gKeys[1].turn=1}else{gKeys[1].turn++}}break;case"w":if(cpuOption<2){if(typeof gKeys[1].move=="undefined"){gKeys[1].move=1}else{gKeys[1].move++}}break;case"s":if(cpuOption<2){if(typeof gKeys[1].move=="undefined"){gKeys[1].move=-.5}else{gKeys[1].move-=.5}}break;case"Tab":if(cpuOption<2){gKeys[1].fire=1}break}}break;case"side":if(plr.life==60){switch(t){case"ArrowLeft":plr.xAcc--;break;case"ArrowRight":plr.xAcc++;break;case"ArrowUp":plr.yAcc--;break;case"ArrowDown":plr.yAcc++;break;case"a":plr.xDir--;break;case"d":plr.xDir++;break;case"w":plr.yDir--;break;case" ":if(plr.charge==0){plr.charge=1}break;case".":break}if(plr.xDir||plr.yDir){plr.cTarget=Math.atan2(plr.yDir,plr.xDir);if(plr.cTarget>0){plr.cTarget-=6.28}}}break}}}function hku(e){let t=getKey(e);switch(scene){case"menu":case"final":switch(t){case"ArrowLeft":if(typeof menu.col!="undefined"){menu.col++}break;case"ArrowRight":if(typeof menu.col!="undefined"){menu.col--}break;case"ArrowUp":if(typeof menu.row!="undefined"){menu.row++}break;case"ArrowDown":if(typeof menu.row!="undefined"){menu.row--}break;case" ":menu.start=0;break}break;case"game":switch(t){case"ArrowLeft":if(typeof gKeys[0].turn!="undefined"){gKeys[0].turn++}break;case"ArrowRight":if(typeof gKeys[0].turn!="undefined"){gKeys[0].turn--}break;case"ArrowUp":if(typeof gKeys[0].move!="undefined"){gKeys[0].move--}break;case"ArrowDown":if(typeof gKeys[0].move!="undefined"){gKeys[0].move+=.5}break;case".":gKeys[0].fire=0;break;case"a":if(typeof gKeys[1].turn!="undefined"){gKeys[1].turn++}break;case"d":if(typeof gKeys[1].turn!="undefined"){gKeys[1].turn--}break;case"w":if(typeof gKeys[1].move!="undefined"){gKeys[1].move--}break;case"s":if(typeof gKeys[1].move!="undefined"){gKeys[1].move+=.5}break;case"Tab":gKeys[1].fire=0;break}break;case"side":if(plr.life==60){switch(t){case"ArrowLeft":plr.xAcc++;break;case"ArrowRight":plr.xAcc--;break;case"ArrowUp":plr.yAcc++;break;case"ArrowDown":plr.yAcc--;break;case"a":plr.xDir++;break;case"d":plr.xDir--;break;case"w":plr.yDir++;break;case" ":shots.push(new Shot(plr));plr.charge=0;break}}break}}document.addEventListener("keydown",hkd);document.addEventListener("keyup",hku);function calculateGain(e,t,l){var r;switch(t){case"sine":r=l?4:2;break;case"triangle":r=l?5:2;break;case"sawtooth":r=l?20:5;break;case"square":r=l?22:6;break}return Math.pow(1.05,e/-20)/r}function stopSound(e,t){if(!audio||!e||!t){return null}let l=audio.currentTime;t.gain.setValueAtTime(t.gain.value,l);t.gain.linearRampToValueAtTime(0,l+.3);e.stop(l+.4);return null}function startTreadsSound(e){if(!audio||audio.mute){return{o:0,g:0}}let t=audio.currentTime;var l=audio.createOscillator();var r=audio.createGain();l.connect(r);r.connect(audio.destination);let n=e==0?110:74;l.frequency.value=n;l.type="triangle";let a=calculateGain(n,"triangle",true);r.gain.value=a;r.gain.setValueAtTime(0,t);r.gain.linearRampToValueAtTime(a,t+.1);l.start(t);return{o:l,g:r}}function startTurnSound(e){if(!audio||audio.mute){return{o:0,g:0}}let t=audio.currentTime;var l=audio.createOscillator();var r=audio.createGain();l.connect(r);r.connect(audio.destination);let n=e==0?220:148;l.frequency.value=n;l.type="triangle";let a=calculateGain(n,"triangle",true);r.gain.value=a;r.gain.setValueAtTime(0,t);r.gain.linearRampToValueAtTime(a,t+.1);l.start(t);return{o:l,g:r}}function playTone(e,t,l,r){if(!audio||audio.mute){return 0}let n=audio.currentTime+e;var a=audio.createOscillator();var i=audio.createGain();a.connect(i);i.connect(audio.destination);if(l){a.frequency.value=l}else{l=a.frequency.value}if(r){a.type=r}else{r=a.type}let o=calculateGain(l,r);i.gain.setValueAtTime(0,n);i.gain.linearRampToValueAtTime(o,n+.02);i.gain.linearRampToValueAtTime(0,n+t);a.start(n);a.stop(n+t)}function playFireSound(e){if(!audio||audio.mute){return 0}let t=audio.currentTime;var l=audio.createOscillator();var r=audio.createGain();l.connect(r);r.connect(audio.destination);let n=e==0?55:37;l.frequency.value=n;l.type="square";r.gain.setValueAtTime(calculateGain(n,"square"),t);r.gain.linearRampToValueAtTime(0,t+.2);l.start(t);l.stop(t+.2)}function playRicochetSound(e){if(!audio||audio.mute){return 0}let t=audio.currentTime;var l=audio.createOscillator();var r=audio.createGain();l.connect(r);r.connect(audio.destination);let n=e==0?220:148;l.frequency.value=n;l.type="square";r.gain.setValueAtTime(calculateGain(n,"square"),t);r.gain.linearRampToValueAtTime(0,t+.2);l.start(t);l.stop(t+.2)}function playExplodeSound(e){if(!audio||audio.mute){return 0}var t=audio.currentTime;var l=audio.createOscillator();var r=audio.createGain();l.connect(r);r.connect(audio.destination);let n=e==0?220:148;l.type="square";let a=calculateGain(n,"square");r.gain.setValueAtTime(a,t);r.gain.setValueAtTime(a,t+.3);r.gain.linearRampToValueAtTime(0,t+.4);l.frequency.setValueAtTime(n,t);l.frequency.exponentialRampToValueAtTime(n/4,t+.4);l.start(t);l.stop(t+.4)}var context=document.getElementById("canvas").getContext("2d");context.camera={x:0,y:0};var prerender=document.getElementById("prerender");let question=document.getElementById("question").getContext("2d");question.strokeStyle="#FFF";question.lineWidth=6;question.strokeRect(0,0,94,80);question.fillStyle="#FFF";question.font="32px Intellect";question.textAlign="center";var fontLoaded=false;var maxLoops=3e3;while(!fontLoaded&&maxLoops>0){let e=document.getElementById("pretext").getContext("2d").getImageData(244,176,1,1).data;if(e[0]){fontLoaded=true}prerenderTitle();question.fillText("?",48,54);maxLoops--}fontLoaded=null;question=null;function step(e){context.clearRect(0,0,800,640);switch(scene){case"title":context.drawImage(prerender,0,0);break;case"menu":if(menu.delay==0){if(menu.start){scene="game";menu.start=0;if(levelOption==RANDOM){level=LEVELS[Math.random()*RANDOM>>0]}else{level=LEVELS[levelOption]}prerenderLevel(level,levelNum,score,round,roundLimit);bubbles=generateBubbles(level,levelNum)}else{if(menu.row){if(menu.row<0&&optionRow>0){optionRow--}if(menu.row>0&&optionRow<4){optionRow++}playTone(0,.2,120,"triangle");playTone(0,.2,180,"triangle")}if(menu.col){switch(optionRow){case 0:if(menu.col<0&&roundLimit>1){roundLimit-=2}if(menu.col>0&&roundLimit<15){roundLimit+=2}let e=100*(1+roundLimit/15);playTone(0,.2,e,"triangle");playTone(0,.2,1.33*e,"triangle");break;case 1:if(menu.col<0&&paletteOption>0){paletteOption--}if(menu.col>0&&paletteOption<3){paletteOption++}playTone(0,.2,150,"triangle");playTone(0,.2,200,"triangle");break;case 2:if(menu.col<0&&cpuOption>0){cpuOption--}if(menu.col>0&&cpuOption<3){cpuOption++}playTone(0,.2,150,"triangle");playTone(0,.2,200,"triangle");break;case 3:if(menu.col<0&&cpuSkill>0){cpuSkill--}if(menu.col>0&&cpuSkill<3){cpuSkill++}playTone(0,.2,150,"triangle");playTone(0,.2,200,"triangle");break;case 4:if(menu.col<0&&levelOption>0){levelOption--}if(menu.col>0&&levelOption<RANDOM){levelOption++}if(levelOption<RANDOM){levelNum=RANDOM*Math.random()>>0}else{levelNum=levelOption}playTone(0,.2,150,"triangle");playTone(0,.2,200,"triangle");break}prerenderMenu(roundLimit,paletteOption,cpuOption,cpuSkill,levelOption)}if(menu.row||menu.col){switch(optionRow){case 0:if(roundLimit==1){if(menu.showLeft){menu.showLeft=0}}else if(!menu.showLeft){menu.showLeft=1}if(roundLimit==15){if(menu.showRight){menu.showRight=0}}else if(!menu.showRight){menu.showRight=1}break;case 1:if(paletteOption==0){if(menu.showLeft){menu.showLeft=0}}else if(!menu.showLeft){menu.showLeft=1}if(paletteOption==3){if(menu.showRight){menu.showRight=0}}else if(!menu.showRight){menu.showRight=1}break;case 2:if(cpuOption==0){if(menu.showLeft){menu.showLeft=0}}else if(!menu.showLeft){menu.showLeft=1}if(cpuOption==3){if(menu.showRight){menu.showRight=0}}else if(!menu.showRight){menu.showRight=1}break;case 3:if(cpuSkill==0){if(menu.showLeft){menu.showLeft=0}}else if(!menu.showLeft){menu.showLeft=1}if(cpuSkill==3){if(menu.showRight){menu.showRight=0}}else if(!menu.showRight){menu.showRight=1}break;case 4:if(levelOption==0){if(menu.showLeft){menu.showLeft=0}}else if(!menu.showLeft){menu.showLeft=1}if(levelOption==RANDOM){if(menu.showRight){menu.showRight=0}}else if(!menu.showRight){menu.showRight=1}break}menu.delay=20}}}context.drawImage(prerender,0,0);var t=45+90*optionRow;if(menu.showLeft){context.beginPath();context.moveTo(360,t);context.lineTo(400,t-30);context.lineTo(400,t+30);context.closePath();context.fill()}if(menu.showRight){context.beginPath();context.moveTo(760,t);context.lineTo(720,t-30);context.lineTo(720,t+30);context.closePath();context.fill()}if(menu.delay>0){menu.delay--}break;case"final":context.drawImage(prerender,0,0);if(menu.start){prerenderMenu(roundLimit,paletteOption,cpuOption,cpuSkill,levelOption);context.fillStyle="#FFF";scene="menu";menu.start=0;score=[0,0]}break;case"game":for(let e=0;e<2;e++){let t=players[e];let l=players[e^1];if(cpuOption>0){if(cpuOption==3||cpuOption==e+1){if(gKeys[e].fire){gKeys[e].fire=false}let r=0;switch(cpuSkill){case 0:let n=l.x-t.x;let a=l.y-t.y;let i=Math.sqrt(Math.pow(n,2)+Math.pow(a,2));let o=Math.atan2(a,n);if(o<0){o+=6.28}else if(o>=6.28){o-=6.28}let s=o-t.r;if(i<160){if(gKeys[e].move||cpuTargets[e].x>-1||cpuTargets[e].y>-1){gKeys[e].move=0;cpuTargets[e].x=-1;cpuTargets[e].y=-1}if(l.life==60&&t.delay==0){let r;let n=-2;let a=new Shell(t,e);while(n<cpuSkill&&!r&&a.life>0){if(moveShell(players,a,levelNum)){n++}if(shellCollidesWithPlayer(a,l)){r=1}else if(shellCollidesWithPlayer(a,t)){r=-1}}if(r>0){gKeys[e].fire=true}}if(s>3.14){r=-1}else if(s<-3.14){r=1}else if(s>.05){r=1}else if(s<-.05){r=-1}}else{let n=cpuTargets[e].x-t.x;let a=cpuTargets[e].y-t.y;if(n>-1&&n<1&&a>-1&&a<1||cpuTargets[e].x<0&&cpuTargets[e].y<0){if(gKeys[e].move){gKeys[e].move=0}let r=levelNum==5?25:20;let n=getTileIndex(t.x,t.y,levelNum);let a=level[n-1];let i=level[n+1];let o=level[n-r];let s=level[n+r];let u=level[n-1-r];let c=level[n+1-r];let f=level[n-1+r];let p=level[n+1+r];let y=[];if(typeof a=="number"&&a!=3&&a!=4&&n%r>0){y.push(n-1)}if(typeof i=="number"&&i!=3&&i!=4&&n%r<r-1){y.push(n+1)}if(typeof o=="number"&&o!=3&&o!=4&&n/r>=1){y.push(n-r)}if(typeof s=="number"&&s!=3&&s!=4&&n/r<20*(r-1)){y.push(n+r)}if(typeof u=="number"&&u!=3&&u!=4&&(n-1)%r>0){y.push(n-r-1)}if(typeof c=="number"&&c!=3&&c!=4&&(n+1)%r<r-1){y.push(n-r+1)}if(typeof f=="number"&&f!=3&&f!=4&&(n-1)/r>=1){y.push(n+r-1)}if(typeof p=="number"&&p!=3&&p!=4&&(n+1)/r<20*(r-1)){y.push(n+r+1)}let d;let m=Math.sqrt(Math.pow(l.x-t.x,2)+Math.pow(l.y-t.y,2));let g=1200;for(let e=0;e<8;e++){if(typeof y[0]=="number"){let t=32*(y[e]%r)+16;let n=32*(y[e]/r>>0)+16;let a=Math.sqrt(Math.pow(l.x-t,2)+Math.pow(l.y-n,2));if(a<m&&a<g){d=y[e];g=a}}}if(d){cpuTargets[e].x=32*(d%r)+16;cpuTargets[e].y=32*(d/r>>0)+16}else{cpuTargets[e].x=-1;cpuTargets[e].y=-1}}if(cpuTargets[e].x>-1&&cpuTargets[e].y>-1){let l=cpuTargets[e].x-t.x;let n=cpuTargets[e].y-t.y;let a=Math.sqrt(Math.pow(l,2)+Math.pow(n,2));let i=Math.atan2(n,l);if(i<0){i+=6.28}else if(i>=6.28){i-=6.28}let o=i-t.r;if(o>3.14){r=-1}else if(o<-3.14){r=1}else if(o>.05){r=1}else if(o<-.05){r=-1}else{t.r=i}if(r){if(gKeys[e].turn){gKeys[e].turn=0}}else if(!gKeys[e].turn){gKeys[e].turn=r}}}break}if(r){if(!gKeys[e].turn){gKeys[e].turn=r}}else{if(gKeys[e].turn){gKeys[e].turn=0}}}}if(t.life<60){if(t.life>-30){t.life--}else{trails=[[],[]];if(round<roundLimit){shells=[];if(levelOption==RANDOM){levelNum=Math.random()*RANDOM>>0;level=LEVELS[levelNum];prerenderLevel(level,levelNum,score,++round,roundLimit);bubbles=generateBubbles(level,levelNum)}else{prerenderScore(score,++round,roundLimit)}if(players[0].treads){players[0].treads=stopSound(players[0].treads.o,players[0].treads.g)}if(players[1].treads){players[1].treads=stopSound(players[1].treads.o,players[1].treads.g)}if(players[0].turn){players[0].turn=stopSound(players[0].turn.o,players[0].turn.g)}if(players[1].turn){players[1].turn=stopSound(players[1].turn.o,players[1].turn.g)}players=[{x:64,y:64,r:0,life:60,delay:0,shells:0},{x:576,y:576,r:3.14,life:60,delay:0,shells:0}];gKeys[0]={};gKeys[1]={}}else{prerenderFinal(roundLimit,score);players[0].l=false;players[1].l=false;round=0;scene="final"}break}}else{let l=level[getTileIndex(t.x,t.y,levelNum)];if(gKeys[e].turn){t.r+=gKeys[e].turn*.05;while(t.r<0){t.r+=6.28}while(t.r>6.28){t.r-=6.28}if(!players[e].turn){players[e].turn=startTurnSound(e)}}else if(players[e].turn){players[e].turn=stopSound(players[e].turn.o,players[e].turn.g)}if(gKeys[e].move){if(!players[e].treads){players[e].treads=startTreadsSound(e)}if(l==5&&!players[e].l){players[e].l=true;trails[e]=[]}let r=Math.cos(t.r);let n=Math.sin(t.r);let a=l==2?1:2;let i=a*gKeys[e].move*r+t.x;let o=a*gKeys[e].move*n+t.y;let s=level[getTileIndex(gKeys[e].move*16*r+t.x,gKeys[e].move*16*n+t.y,levelNum)];if(i<16){t.x=16}else if(levelNum>4&&i>784){t.x=784}else if(levelNum<5&&i>624){t.x=624}else if(s<3||s>4){t.x=i}if(o<16){t.y=16}else if(o>624){t.y=624}else if(s<3||s>4){t.y=o}}else if(players[e].treads){players[e].treads=stopSound(players[e].treads.o,players[e].treads.g)}if(gKeys[e].fire&&t.delay==0&&t.shells<3){t.delay=60;t.shells++;shells.push(new Shell(t,e));playFireSound(e)}let r=true;let n=0;for(let l=0;l<8;l++){let a=trails[e][l];if(r){if(a){let e=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2));let l=t.r-a.r;if(e<18&&l>-1&&l<1){r=false}}}if(a){n++}}if(r){if(n==8){trails[e]=trails[e].slice(1)}trails[e].push({x:t.x,y:t.y,r:t.r})}if(t.delay>0){t.delay--}}}context.drawImage(prerender,0,0);if(levelOption>3){context.strokeStyle="#FE6";context.lineWidth=2;for(let e=0;e<400;e++){if(bubbles[e]){if(bubbles[e].step<90){context.beginPath();context.arc(bubbles[e].x+14,bubbles[e].y+10,5*(bubbles[e].step/90),0,6.28);context.stroke();context.closePath()}if(bubbles[e].step>=30){context.beginPath();context.arc(bubbles[e].x+8,bubbles[e].y+24,4*((bubbles[e].step-30)/90),0,6.28);context.stroke();context.closePath()}if(bubbles[e].step<30){context.beginPath();context.arc(bubbles[e].x+24,bubbles[e].y+20,4*((bubbles[e].step+60)/90),0,6.28);context.stroke();context.closePath()}else if(bubbles[e].step>=60){context.beginPath();context.arc(bubbles[e].x+24,bubbles[e].y+20,4*((bubbles[e].step-60)/90),0,6.28);context.stroke();context.closePath()}bubbles[e].step++;if(bubbles[e].step>120){bubbles[e].step=0}}else{break}}}for(let e=0;e<2;e++){let t=players[e];let l=[];let r=[];context.beginPath();context.strokeStyle=t.l?"rgba(223,32,16,0.75)":"rgba(32,16,0,0.6)";context.lineWidth=6;for(let t=0;t<8&&typeof trails[e][t]!=="undefined";t++){let n=trails[e][t];l.push(6*Math.cos(n.r+1.57));r.push(6*Math.sin(n.r+1.57));context[t==0?"moveTo":"lineTo"](n.x+l[t],n.y+r[t])}context.lineTo(t.x+6*Math.cos(t.r+1.57),t.y+6*Math.sin(t.r+1.57));context.stroke();context.closePath();context.beginPath();for(let t=0;t<8&&typeof trails[e][t]!=="undefined";t++){let n=trails[e][t];context[t==0?"moveTo":"lineTo"](n.x-l[t],n.y-r[t])}context.lineTo(t.x-6*Math.cos(t.r+1.57),t.y-6*Math.sin(t.r+1.57));context.stroke();context.closePath()}for(let e=0;e<2;e++){let t=players[e];let l=playerColors[paletteOption];if(t.life==60){renderTank(context,t,l[e])}else if(t.life>0){let r=(60-t.life)/3>>0;context.strokeStyle=l[e];context.lineWidth=2;context.beginPath();context.moveTo(t.x+r/4,t.y);context.arc(t.x,t.y,r/4,0,6.28);if(t.life>5){context.moveTo(t.x+r/2,t.y);context.arc(t.x,t.y,r/2,0,6.28)}if(t.life>15){context.moveTo(t.x+r,t.y);context.arc(t.x,t.y,r,0,6.28)}context.stroke()}}let e=[];for(let e=0;e<6&&typeof shells[e]!=="undefined";e++){let t=shells[e];if(moveShell(players,t,levelNum)){playRicochetSound(t.n)}context.fillStyle=players[t.n].l?"#FAA":"#FFE";context.fillRect(t.x-2,t.y-2,4,4)}for(let t=0;t<6&&typeof shells[t]!=="undefined";t++){let l=shells[t];for(let e=0;e<2;e++){if(shellCollidesWithPlayer(l,players[e])){if(players[t].treads){players[t].treads=stopSound(players[t].treads.o,players[t].treads.g)}if(players[t].turn){stopSound(players[t].turn.o,players[t].turn.g)}playExplodeSound(e);players[e].life--;score[e^1]++;l.life=0;prerenderScore(score,round,roundLimit)}}if(l.life>0){e.push(l)}else{players[l.n].shells--}}shells=e;break}if(!l){var l=e}if(e-l<2e3){window.requestAnimationFrame(step)}}window.requestAnimationFrame(step);</script></html>
